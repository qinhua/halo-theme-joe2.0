(()=>{window.encryption=function(e){return window.btoa(unescape(encodeURIComponent(e)))},window.decrypt=function(e){return decodeURIComponent(escape(window.atob(e)))};var r={initMode:function(){var o,n,a,i;"scrollRestoration"in history&&(history.scrollRestoration="manual"),"user"===ThemeConfig.theme_mode&&(o=$("html"),n=$(".mode-light"),a=$(".mode-dark"),i=localStorage.getItem("data-mode"),n["".concat("light"===i?"remove":"add","Class")]("active"),a["".concat("light"===i?"add":"remove","Class")]("active"),$(".joe_action_item.mode").on("click",function(e){e.stopPropagation();try{i=localStorage.getItem("data-mode");var t="";i?(t="light"===i?"dark":"light",n["".concat("light"===i?"add":"remove","Class")]("active"),a["".concat("light"===i?"remove":"add","Class")]("active")):(t="dark",n.removeClass("active"),a.addClass("active")),o.attr("data-mode",t),localStorage.setItem("data-mode",t),r.initCommentTheme()}catch(e){console.log(e)}}))},loadingBar:{show:function(){ThemeConfig.enable_loading_bar&&(NProgress.configure({easing:"ease",speed:500,showSpinner:!1}),NProgress.start())},hide:function(){ThemeConfig.enable_loading_bar&&NProgress.done(!0)}},initNavbar:function(){var e=$(".joe_header__above-nav a"),t=$(".panel-side-menu .link"),o=0,n=location,a=n.href,i=n.pathname,n=(e.each(function(e,t){t=t.getAttribute("href");(i.includes(t)||a.includes(t))&&(o=e)}),e.eq(o));n.addClass("current"),n.parents(".joe_dropdown").length&&n.parents(".joe_dropdown").find(".joe_dropdown__link a").addClass("current"),t.eq(o).addClass("current")},initFooter:function(){ThemeConfig.enable_footer&&"fixed"===ThemeConfig.footer_position&&$("#Joe").css("margin-bottom",$(".joe_footer").height()+30)},initCommentTheme:function(){for(var e=document.getElementsByTagName("halo-comment"),t=document.querySelector("html").getAttribute("data-mode"),o=0;o<e.length;o++){var n=e[o].shadowRoot.getElementById("halo-comment");$(n)["".concat("light"===t?"remove":"add","Class")]("dark")}},initCode:function(a){var e=$(".page-post pre, .page-journals pre, .page-sheet pre");e.length&&e.each(function(e,t){var o,n,t=$(t);0<t.find("code").length&&(a?t.find(".code-expander").off("click").on("click",function(e){e.stopPropagation();var e=$(this),t=e.parent("pre").siblings(".toolbar").find(".autofold-tip");t&&t.remove(),e.parent("pre").toggleClass("close")}):(ThemeConfig.enable_code_title&&t.addClass("c_title"),ThemeConfig.enable_code_hr&&t.addClass("c_hr"),ThemeConfig.enable_code_macdot&&t.addClass("c_macdot"),ThemeConfig.enable_code_newline&&t.addClass("c_newline"),ThemeConfig.show_tools_when_hover&&t.addClass("c_hover_tools"),ThemeConfig.enable_code_expander&&(t.prepend('<i class="joe-font joe-icon-arrow-downb code-expander" title="折叠/展开"></i>').addClass("c_expander"),t.find(".code-expander").on("click",function(e){e.stopPropagation();var e=$(this),t=e.parent("pre").siblings(".toolbar").find(".autofold-tip");t&&t.remove(),e.parent("pre").toggleClass("close")})),ThemeConfig.enable_code_copy&&(o=t.find("code[class*='language-']").text(),n=$('<span class="copy-button"><i class="joe-font joe-icon-copy" title="复制代码"></i></span>'),new ClipboardJS(n[0],{text:function(){return o}}).on("success",function(){return Qmsg.success("复制成功！")}),t.addClass("c_copy").append(n))))})},foldCode:function(){$(".page-post").length&&ThemeConfig.enable_code_expander&&ThemeConfig.enable_fold_long_code&&"false"!==PageAttrs.metas.enable_fold_long_code&&$(".page-post pre[class*='language-']").each(function(e,t){t=$(t);t.height()>ThemeConfig.long_code_height&&(t.siblings(".toolbar").find(".toolbar-item span").eq(0).append('<em class="autofold-tip"><已自动折叠></em>'),t.addClass("close"))})},initBaidu:function(){ThemeConfig.check_baidu_collect&&$("#joe_baidu_record").length&&Utils.request({url:ThemeConfig.BASE_URL+"/halo-api/bd/iscollect",method:"GET",returnRaw:!0,data:{url:ThemeConfig.blog_url+window.location.pathname}}).then(function(e){var t;e.data&&e.data.collected?$("#joe_baidu_record").css("color","#67c23a").html("已收录"):ThemeConfig.baidu_token?($("#joe_baidu_record").html('<span style="color: #e6a23c">未收录，推送中...</span>'),t=setTimeout(function(){Utils.request({url:ThemeConfig.BASE_URL+"/halo-api/bd/push",method:"POST",returnRaw:!0,data:{site:ThemeConfig.blog_url,token:ThemeConfig.baidu_token,urls:window.location.href}}).then(function(e){0===e.data.success?$("#joe_baidu_record").html('<span style="color: #f56c6c">推送失败，请检查！</span>'):$("#joe_baidu_record").html('<span style="color: #67c23a">推送成功！</span>')}).catch(function(e){console.log(e)}),clearTimeout(t),t=null},1e3)):(e="https://ziyuan.baidu.com/linksubmit/url?sitename=".concat(encodeURI(window.location.href)),$("#joe_baidu_record").html('<a target="_blank" href="'.concat(e,'" rel="noopener noreferrer nofollow" style="color: #f56c6c">未收录，提交收录</a>')))}).catch(function(e){console.log(e)})},initMusic:function(){ThemeConfig.enable_global_music_player&&Utils.request({url:"".concat(ThemeConfig.music_api,"?server=").concat(ThemeConfig.music_source,"&type=").concat(ThemeConfig.music_player_type,"&id=").concat(ThemeConfig.music_list_id),type:"GET",returnRaw:!0}).then(function(e){new APlayer({container:document.getElementById("global-aplayer"),fixed:!0,lrcType:0,theme:ThemeConfig.music_player_theme,autoplay:ThemeConfig.music_auto_play,volume:ThemeConfig.music_player_volume,loop:ThemeConfig.music_loop_play,audio:e})}).catch(function(e){console.log(e)})},initPDF:function(){var e=$("joe-pdf");e.length&&e.each(function(e,t){var o=$(t),o=(options={src:o.attr("src")||"",width:o.attr("width")||"100%",height:o.attr("height")||"500px"}).src?'\n      <div class="joe_pdf">\n        <iframe src="'.concat(ThemeConfig.BASE_RES_URL,"/source/lib/pdfjs/web/viewer.html?file=").concat(options.src,'" style="width:').concat(options.width,";height:").concat(options.height,'"></iframe>\n      </div>'):"<p>pdf地址未填写！</p>";$(t).replaceWith(o)})},back2Top:function(){var t,e;ThemeConfig.enable_back2top&&(t=$(".joe_action_item.back2top"),(e=function(){var e=document.documentElement.scrollTop||document.body.scrollTop;t[(300<e?"add":"remove")+"Class"]("active")})(),$(document).on("scroll",Utils.throttle(e,120)),t.on("click",function(e){e.stopPropagation(),$("html,body").animate({scrollTop:0},ThemeConfig.enable_back2top_smooth?500:0)}))},initTimeCount:function(){var e,t,o,n,a;!Joe.isMobile&&$(".joe_aside__item.timelife").length&&(e=[{title:"今日已经过去",endTitle:"小时",num:0,percent:"0%"},{title:"这周已经过去",endTitle:"天",num:0,percent:"0%"},{title:"本月已经过去",endTitle:"天",num:0,percent:"0%"},{title:"今年已经过去",endTitle:"个月",num:0,percent:"0%"}],n=(t=(+new Date-new Date((new Date).toLocaleDateString()).getTime())/1e3/60/60)/24*100,e[0].num=parseInt(t),e[0].percent=parseInt(n)+"%",n=(t={0:7,1:1,2:2,3:3,4:4,5:5,6:6}[(new Date).getDay()])/7*100,e[1].num=parseInt(t),e[1].percent=parseInt(n)+"%",t=(new Date).getFullYear(),n=(new Date).getDate(),o=(new Date).getMonth()+1,t=n/new Date(t,o,0).getDate()*100,e[2].num=n,e[2].percent=parseInt(t)+"%",n=(o=(new Date).getMonth()+1)/12*100,e[3].num=o,e[3].percent=parseInt(n)+"%",a="",e.forEach(function(e,t){a+='\n\t\t\t\t\t\t<div class="item">\n\t\t\t\t\t\t\t<div class="title">\n\t\t\t\t\t\t\t\t'.concat(e.title,'\n\t\t\t\t\t\t\t\t<span class="text">').concat(e.num,"</span>\n\t\t\t\t\t\t\t\t").concat(e.endTitle,'\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="progress">\n\t\t\t\t\t\t\t\t<div class="progress-bar">\n\t\t\t\t\t\t\t\t\t<div class="progress-bar-inner progress-bar-inner-').concat(t,'" style="width: ').concat(e.percent,'"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="progress-percentage">').concat(e.percent,"</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>")}),$(".joe_aside__item.timelife .joe_aside__item-contain").html(a))},initWeather:function(){!Joe.isMobile&&ThemeConfig.enable_weather&&ThemeConfig.weather_key&&$("#he-plugin-simple").length&&(window.WIDGET={CONFIG:{modules:"120",background:"5",tmpColor:"FFFFFF",tmpSize:"13",cityColor:"FFFFFF",citySize:"13",aqiColor:"FFFFFF",aqiSize:"13",weatherIconSize:"13",alertIconSize:"13",padding:"5px 5px 4px 5px",shadow:"0",language:"auto",borderRadius:"4",fixed:"true",vertical:"top",horizontal:"left",key:ThemeConfig.weather_key}},$.getScript("https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"))},initGallery:function(){var e=$(".page-post .joe_detail__article img:not([class]), .page-journals .joe_journal_block img:not([class]), .page-sheet img:not([class])");e.length&&e.each(function(){var e=$(this);e.wrap($('<span style="display: block;" data-fancybox="Joe" href="'.concat(e.attr("src"),'"></span>')))})},initExternalLink:function(){var e;"default"!==ThemeConfig.link_behavior?(e=$(".joe_main_container a[href]")).length&&e.each(function(){var e,t=$(this);t.attr("href").includes("javascript:;")||(e="new"!==ThemeConfig.link_behavior||t.attr("href").startsWith("#")?"":"_blank",t.attr({target:e,rel:"noopener noreferrer nofollow"}))}):(e=$(".page-post .joe_detail__article a[href], .joe_journal_body a[href], .page-sheet .joe_detail__article a[href]")).length&&e.each(function(){var e=$(this),t=e.attr("href");t.includes("javascript:;")||(t=t.startsWith("#")?"":"_blank",e.attr({target:t,rel:"noopener noreferrer nofollow"}))})},init3dTag:function(){!Joe.isMobile&&ThemeConfig.enable_tag_cloud&&"3d"===ThemeConfig.tag_cloud_type&&$(".tags-cloud-list").length&&$.getScript("".concat(ThemeConfig.BASE_RES_URL,"/source/lib/3dtag/3dtag.min.js"),function(e){var n=[],a=["#F8D800","#0396FF","#EA5455","#7367F0","#32CCBC","#F6416C","#28C76F","#9F44D3","#F55555","#736EFE","#E96D71","#DE4313","#D939CD","#4C83FF","#F072B6","#C346C2","#5961F9","#FD6585","#465EFB","#FFC600","#FA742B","#5151E5","#BB4E75","#FF52E5","#49C628","#00EAFF","#F067B4","#F067B4","#ff9a9e","#00f2fe","#4facfe","#f093fb","#6fa3ef","#bc99c4","#46c47c","#f9bb3c","#e8583d","#f68e5f"];$(".tags-cloud-list a").each(function(e,t){var o;n.push({label:$(t).attr("data-label"),url:$(t).attr("data-url"),target:"_blank",fontColor:a[t=a.length-1,o=Math.ceil(0),t=Math.floor(t),Math.floor(Math.random()*(t-o+1))+o],fontSize:16})}),$("#tags-3d").svg3DTagCloud({entries:n,width:250,height:250,radius:"65%",radiusMin:75,bgDraw:!1,fov:800,speed:.5,fontWeight:500}),$(".tags-cloud-list").remove(),$("#tags-3d .empty").remove()})},searchDialog:function(){var t=$(".joe_header__above-search .result");$(".joe_header__above-search .input").on("click",function(e){e.stopPropagation(),t.addClass("active")}),$(document).on("click",function(){t.removeClass("active")})},initDropMenu:function(){$(".joe_dropdown").each(function(e,t){var o=this,n=$(this).find(".joe_dropdown__menu"),a=$(t).attr("trigger")||"click",t=$(t).attr("placement")||$(this).height()||0;n.css("top",t),"hover"===a?$(this).hover(function(){return $(o).addClass("active")},function(){return $(o).removeClass("active")}):($(this).on("click",function(e){var t=this;e.stopPropagation(),$(this).toggleClass("active"),$(document).one("click",function(){return $(t).removeClass("active")}),e.stopPropagation()}),n.on("click",function(e){return e.stopPropagation()}))})},drawerMobile:function(){$(".joe_header__above-slideicon").on("click",function(e){e.stopPropagation(),$(".joe_header__searchout").removeClass("active");var e=$("html"),t=$(".joe_header__mask"),o=$(".joe_header__slideout");o.hasClass("active")?(e.removeClass("disable-scroll"),t.removeClass("active slideout"),o.removeClass("active")):(window.sessionStorage.setItem("lastScroll",e.scrollTop()),e.addClass("disable-scroll"),t.addClass("active slideout"),o.addClass("active"))})},searchMobile:function(){$(".joe_header__above-searchicon").on("click",function(e){e.stopPropagation(),$(".joe_header__slideout").removeClass("active");var e=$("html"),t=$(".joe_header__mask"),o=$(".joe_header__above"),n=$(".joe_header__searchout");n.hasClass("active")?(e.removeClass("disable-scroll"),t.removeClass("active slideout"),n.removeClass("active"),o.removeClass("solid")):(window.sessionStorage.setItem("lastScroll",e.scrollTop()),e.addClass("disable-scroll"),t.addClass("active"),o.addClass("solid"),n.addClass("active"))})},maskClose:function(){$(".joe_header__mask").on("click",function(e){e.stopPropagation();var e=$("html"),t=(e.removeClass("disable-scroll"),$(".joe_header__mask").removeClass("active slideout"),$(".joe_header__searchout").removeClass("active"),$(".joe_header__slideout").removeClass("active"),$(".joe_header__toc").removeClass("active"),$(".joe_header__above").removeClass("solid"),window.sessionStorage.getItem("lastScroll"));t&&e.scrollTop(t),window.sessionStorage.removeItem("lastScroll")}).on("touchmove",function(e){return e.preventDefault})},sideMenuMobile:function(){$(".joe_header__slideout-menu .current").parents(".panel-body").show().siblings(".panel").addClass("in"),$(".joe_header__slideout-menu .panel").on("click",function(e){e.stopPropagation();var e=$(this),t=e.parent().parent();t.find(".panel").not(e).removeClass("in"),t.find(".panel-body").not(e.siblings(".panel-body")).stop().hide("fast"),e.toggleClass("in").siblings(".panel-body").stop().toggle("fast")})},initHeadScroll:function(){var e,t,o,n,a,i,r;Joe.isMobile||ThemeConfig.enable_fixed_header||(t=e=0,o=$(".joe_header__above"),n=$(".joe_aside_post, .joe_aside .joe_aside__item:last-child"),a=o.height(),n&&(i=a+15,r=a-60+15),document.addEventListener("scroll",Utils.throttle(function(){window.tocPhase||(e=window.scrollY,t<e&&a<e?(o.addClass("active"),n&&n.css("top",r)):e<t&&(o.removeClass("active"),n&&n.css("top",i)),t=e)},100)))},renderReplyEmoji:function(){$(".aside-reply-content").each(function(e,t){var o=marked(t.innerHTML).replace(/<img\ssrc[^>]*>/gm,'<i class="joe-font joe-icon-tupian"></i>').replace(/bili\//g,"bili/hd/ic_emoji_"),o=Utils.renderedEmojiHtml(o);t.innerHTML=Utils.return2Br(o)})},cancelSpaceScroll:function(){document.body.onkeydown=function(e){var t=(e=e||window.event).target||e.srcElement;32!==(e.keyCode||e.charCode)||["text","input","textarea","halo-comment"].includes(t.tagName.toLowerCase())||(window.event?e.returnValue=!1:e.preventDefault())}},scrollToHash:function(e){var t,o,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;(e=e||window.decodeURIComponent(location.hash))&&(t=$(".joe_header").height(),(o=$(e))&&0<o.length&&(o=o.offset().top-t-15,0<n?$("html,body").animate({scrollTop:o},n):document.documentElement.scrollTop=o))},loadMouseEffect:function(){Joe.isMobile||ThemeConfig.enable_clean_mode||"off"===ThemeConfig.cursor_effect||$.getScript("".concat(ThemeConfig.BASE_RES_URL,"/source/effect/cursor/").concat(ThemeConfig.cursor_effect,".js"))},loadBackdropEffect:function(){Joe.isMobile||ThemeConfig.enable_clean_mode||"off"===ThemeConfig.backdrop||$.getScript("".concat(ThemeConfig.BASE_RES_URL,"/source/effect/backdrop/").concat(ThemeConfig.backdrop,".js"))},setFavicon:function(){var e,t;ThemeConfig.favicon&&(e=new Favico,(t=new Image).onload=function(){e.image(t)},t.src=ThemeConfig.favicon)},offscreenTip:function(){var e,t;!Joe.isMobile&&ThemeConfig.enable_offscreen_tip&&(e=document.title,t=null,document.addEventListener("visibilitychange",function(){0<location.href.indexOf(ThemeConfig.blog_url)||"/"!==location.pathname||(document.hidden?(document.title=ThemeConfig.offscreen_title_leave||"歪，你去哪里了？",clearTimeout(t)):(document.title=ThemeConfig.offscreen_title_back||"(つェ⊂)咦，又回来了!",t=setTimeout(function(){document.title=e},2e3)))}))},initBirthday:function(){var l,s,d,h,m,e;ThemeConfig.enable_birthday&&(/^\d+$/.test(ThemeConfig.birthday)||/^(\d{4}\/\d{1,2}\/\d{1,2}\s\d{1,2}:\d{1,2}(:\d{0,2})?)$/.test(ThemeConfig.birthday)?(l=new Date(/^\d+$/g.test(ThemeConfig.birthday)?+ThemeConfig.birthday:ThemeConfig.birthday),s=$(".joe_run__day"),d=$(".joe_run__hour"),h=$(".joe_run__minute"),m=$(".joe_run__second"),(e=function(){var e=(+new Date-l.getTime())/864e5,t=Math.floor(e),o=24*(e-t),n=Math.floor(o),a=60*(o-n),i=Math.floor(a),r=60*(a-i),c=Math.floor(r),e=String(t).padStart(2,0),o=String(n).padStart(2,0),a=String(i).padStart(2,0),r=String(c).padStart(2,0);s.html(e),d.html(o),h.html(a),m.html(r)})(),setInterval(e,1e3)):Qmsg.error("“自定义博客起始时间” 格式错误，请检查！"))},showLoadTime:function(){var e;!Joe.isMobile&&ThemeConfig.show_loaded_time&&(e=performance.now())&&console.log("%c页面加载耗时："+Math.round(e)+" ms","padding: 6px 8px;color:#fff;background:linear-gradient(270deg, #4edb21, #f15206);border-radius: 3px;")},debug:function(){ThemeConfig.enable_debug&&new window.VConsole},clean:function(){$("#compatiable-checker").remove(),$("#theme-config-getter").remove(),$("#metas-getter").remove(),$("#theme-config-getter").remove(),r.loadingBar.hide()}},t=["loadingBar","init3dTag","foldCode","loadMouseEffect","loadBackdropEffect","setFavicon","initUV","showLoadTime","debug","clean"];document.addEventListener("DOMContentLoaded",function(){r.loadingBar.show(),Object.keys(r).forEach(function(e){return!t.includes(e)&&r[e]()})}),window.addEventListener("load",function(){1===t.length?r[t[0]]():t.forEach(function(e){return"loadingBar"!==e&&r[e]&&r[e]()})}),window.commonContext=r})();