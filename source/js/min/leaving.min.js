(()=>{var o={getData:function(){var e=$(".joe_detail__title").attr("data-sheetid"),t=$(".joe_leaving-list"),a=$(".joe_leaving-none"),n=$(".joe_loading");Utils.request({url:"/api/content/sheets/".concat(e,"/comments/top_view"),method:"GET",data:{page:0,sort:"createTime,desc"}}).then(function(e){e.total?(e=e.content.reduce(function(e,t){t.content.trim()&&(a=marked(t.content).replace(/<img\ssrc[^>]*>/gm,"[图片内容]").replace(/bili\//g,"bili/hd/ic_emoji_"),a=Utils.renderedEmojiHtml(a),t.content=Utils.return2Br(a));var a="".concat(ThemeConfig.gravatar_source||ThemeConfig.gravatar_source_url,"/").concat(t.gravatarMd5,"?s=256&d=").concat(ThemeConfig.gravatar_type);return e+'<li class="item">\n            <div class="user">\n                <img class="avatar lazyload" src="'.concat(ThemeConfig.lazyload_avatar,'" data-src="').concat(a,'" alt="用户头像" onerror="Joe.errorImg(this,').concat(ThemeConfig.comment_avatar_error,')"/>\n                <div class="nickname">').concat(t.author,'</div>\n                <div class="date">').concat(new Date(t.createTime).toLocaleDateString(),'</div>\n            </div>\n            <div class="wrapper">\n                <div class="content leaving-content">').concat(t.content,"</div>\n            </div>\n        </li>")},""),t.html(e),o.randomColor()):(t.hide(),a.show()),n&&n.hide()}).catch(function(e){n&&n.hide(),t.hide(),a.show()})},setEmptyText:function(){$(".joe_leaving-none.tpl").length&&ThemeConfig.leaving_empty_text&&"暂无留言，期待第一个脚印。"!==ThemeConfig.leaving_empty_text.trim()&&$(".joe_leaving-none").text(ThemeConfig.leaving_empty_text)},randomColor:function(){function i(e,t){return Math.floor(Math.random()*(t-e+1))+e}var r=100,d=["#dcc10c","#299bec","#ea5455","#7367f0","#32ccbb","#f6416c","#28c76f","#9f44d3","#f55555","#736efe","#e96d71","#de4313","#d939cd","#4c83ff","#f072b6","#c346c2","#5961f9","#fd6585","#465efb","#ffc600","#fa742b","#5151e5","#bb4e75","#e255cd","#63c549","#0ecdde","#f067b4","#f067b4","#ff9a9e","#1dd5de","#4facfe","#f093fb","#6fa3ef","#bc99c4","#46c47c","#f9bb3c","#e8583d","#f68e5f"],e=$(".joe_leaving-list"),l=e.width(),p=e.height(),f=["20px 300px","20px 400px","20px 500px","30px 300px","30px 400px","30px 500px","40px 300px","40px 400px","40px 500px"],s=["300px 20px","400px 20px","500px 20px","300px 30px","400px 30px","500px 30px","300px 40px","400px 40px","500px 40px"];$(".joe_leaving-list .item").each(function(e,t){var a=i(1,99),n=d[i(0,d.length-1)],o=Math.ceil($(t).width()),c=Math.ceil($(t).height()),c=i(0,p-c),o=i(0,l-o);$(t).css({display:"block",zIndex:a,background:n,top:c,left:o,borderTopLeftRadius:s[i(0,s.length-1)],borderTopRightRadius:f[i(0,f.length-1)],borderBottomLeftRadius:f[i(0,f.length-1)],borderBottomRightRadius:f[i(0,f.length-1)]}),$(t).draggabilly({containment:!0}),$(t).on("dragStart",function(e){r++,$(t).css({zIndex:r})})})}};document.addEventListener("DOMContentLoaded",function(){o.setEmptyText(),o.getData()})})();